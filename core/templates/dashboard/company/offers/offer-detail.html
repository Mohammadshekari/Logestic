{% extends 'dashboard/company/base.html' %}
{% load static %}
{% block title %}
{% endblock title %}

{% block extra_css %}
<link href="{% static 'plugins/summernote/summernote-lite.min.css' %}" rel="stylesheet" />
{% endblock extra_css %}

{% block content %}
<div class="container-xl px-4 mt-5">
    <!-- Knowledge base article-->
    <div class="card mb-4">
        <div class="card-header d-flex align-items-center">
            <a class="btn btn-transparent-dark btn-icon" href="{%  url 'dashboard:company:offer-list' %}"><svg
                    xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="feather feather-arrow-left">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg></a>
            <div class="ms-3">
                <h2 class="my-3">Order #{{order.id}}</h2>
                <small class="text-mute">{{order.created_date|date:"Y-m-d h:i"}}</small>
            </div>
        </div>
        <div class="card-body">
            <div class="border-bottom">
                <div class="row">
                    <div class="col-md-4 mb-4">
                        <div class="card-body row">
                            <h4 class="card-title">Basic Information</h4>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">First name:</span>
                                <span class="text-dark">{{order.first_name}}</span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Last name:</span>
                                <span class="text-dark">{{order.last_name}}</span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Email:</span>
                                <span class="text-dark">{{order.email}}</span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Phone Number:</span>
                                <span class="text-dark">{{order.phone_number}}</span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Living People:</span>
                                <span class="text-dark">{{order.living_people}}</span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Move Dates:</span>
                            </div>
                            <div class="row">
                                {% for item in order.move_dates.all %}
                                <div class="col-3">
                                    <span class="badge bg-light text-dark">{{item.date|date:"Y-m-d"}}</span>
                                </div>
                                {% endfor %}

                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="card-body row">
                            <h4 class="card-title">Origin Details</h4>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Location Type: </span>
                                <span class="text-dark">{{order_origin.get_location_type_display}}</span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Movement Choice: </span>
                                <span class="text-dark">{{order_origin.get_moving_choice_display}}</span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Street: </span>
                                <span class="text-dark">{{order_origin.street}}</span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Zip Code: </span>
                                <span class="text-dark">{{order_origin.zip_code}}</span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">City:</span>
                                <span class="text-dark">{{order_origin.city}}</span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Floor: </span>
                                <span class="text-dark">{{order_origin.floor}}</span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Has Elevator: </span>
                                <span class="text-dark">
                                    {% if order_origin.has_elevator %} Yes {% else %} No {% endif %}

                                </span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Apartment Size: </span>
                                <span class="text-dark">{{order_origin.apartment_size}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="card-body row">
                            <h4 class="card-title">Destination Details</h4>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Location Type: </span>
                                <span class="text-dark">{{order_destination.get_location_type_display}}</span>
                            </div>

                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Street: </span>
                                <span class="text-dark">{{order_destination.street}}</span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Zip Code: </span>
                                <span class="text-dark">{{order_destination.zip_code}}</span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">City:</span>
                                <span class="text-dark">{{order_destination.city}}</span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Floor: </span>
                                <span class="text-dark">{{order_destination.floor}}</span>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span class="fw-bold">Has Elevator: </span>
                                <span class="text-dark">
                                    {% if order_destination.has_elevator %} Yes {% else %} No {% endif %}
                                </span>
                            </div>

                        </div>
                    </div>


                </div>
            </div>

            <div class="card-body border-bottom">
                <h4 class="card-title">Order Description</h4>
                {{ order.description|safe }}
            </div>

            <div class="card-body">
                <div class="row">
                    <h4 class="card-title">Order Images</h4>
                    <div class="d-flex justify-content-start">
                        {% for picture in order_pictures %}
                        <div class="col-md-2 mb-1">
                            <img class="card-img ms-1" src="{{picture.file.url}}" alt="..."
                                style="width: 100%; max-width:100px; height: 100px; object-fit:cover">
                        </div>
                        {% empty %}
                        <p> No Images Yet</p>
                        {% endfor %}

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card mb-4">
        <div class="card-header d-flex align-items-center">
            <div class="ms-3">
                <h2 class="my-3">Offer Description</h2>
                <small class="text-mute">Offered at: {{offer.created_date|date:"Y-m-d h:i"}}</small>
            </div>
        </div>
        <div class="card-body">
            <div class="m-3">{{offer.description|safe}}</div>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header d-flex align-items-center">
            <div class="ms-3">
                <h2 class="my-3">Conversations</h2>
            </div>
        </div>
        <div class="card-body">
            {% for message in messages_query %}
            <div class="d-sm-flex border rounded-3 p-3">
                <div>
                    <div class="mb-3 d-sm-flex justify-content-sm-between align-items-center ">
                        <!-- Title -->
                        <div>
                            <h5 class="m-0">{{message.get_username}} - {{message.get_user_type}}
                            </h5>
                            <span class="me-3 small">
                                <td class="text-center text-sm-start"> {{object.created_date|date:"Y-m-d h:i"}} </td>
                            </span>
                        </div>
                    </div>
                    <p>{{message.description|safe}}</p>

                </div>
            </div>
            {% if not forloop.last %}
            <hr>
            {% endif %}
            {% empty %}
            <div class="justify-content-center text-center"><span>There are no messages at the moment</span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% if not order.is_done and is_agreed_offer %}
    <div class="card mb-4">
        <div class="card-header">Send Message</div>
        <div class="card-body">

            <form method="post" action="{% url 'dashboard:company:offer-send-message' pk=object.pk %}"
                class="row g-3 position-relative">
                {% csrf_token %}
                <!-- Comment -->
                <div class="col-12">
                    <textarea name="description" id="summernote"></textarea>
                </div>


                <div class="col-12 d-flex justify-content-end">
                    <button type="submit" class="btn btn-primary mb-0">submit</button>
                </div>
            </form>
        </div>

    </div>
    {% endif %}
</div>
{% endblock content %}

{% block extra_js %}
<script src="{% static 'plugins/summernote/summernote-lite.min.js' %}"></script>
<script src="{% static 'plugins/summernote/summernote-init.js' %}"></script>

{% endblock extra_js %}